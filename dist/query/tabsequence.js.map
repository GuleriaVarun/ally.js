{"version":3,"sources":["../../src/query/tabsequence.js"],"names":["context","includeContext","includeOnlyTabbable","strategy","supports","_context","document","documentElement","elements","body","createShadowRoot","platform","is","BLINK","sortElements","moveContextToBeginning","pos","indexOf","tmp","splice","concat","tabsequenceAreaAtImgPosition"],"mappings":";;;;;;kBAmCe,YAKP;AAAA,iFAAJ,EAAI;AAAA,MAJNA,OAIM,QAJNA,OAIM;AAAA,MAHNC,cAGM,QAHNA,cAGM;AAAA,MAFNC,mBAEM,QAFNA,mBAEM;AAAA,MADNC,QACM,QADNA,QACM;;AACN,MAAI,CAACC,QAAL,EAAe;AACbA,eAAW,yBAAX;AACD;;AAED,MAAMC,WAAW,yBAAUL,OAAV,EAAmB,CAAnB,KAAyBM,SAASC,eAAnD;AACA,MAAIC,WAAW,wBAAc;AAC3BR,aAASK,QADkB;AAE3BJ,kCAF2B;AAG3BC,4CAH2B;AAI3BC;AAJ2B,GAAd,CAAf;;AAOA,MAAIG,SAASG,IAAT,CAAcC,gBAAd,IAAkCC,mBAASC,EAAT,CAAYC,KAAlD,EAAyD;AACvD;AACA;AACAL,eAAW,2BAAaA,QAAb,EAAuBH,QAAvB,EAAiCS,YAAjC,CAAX;AACD,GAJD,MAIO;AACLN,eAAWM,aAAaN,QAAb,EAAuBH,QAAvB,CAAX;AACD;;AAED,MAAIJ,cAAJ,EAAoB;AAClB;AACA;AACAO,eAAWO,uBAAuBP,QAAvB,EAAiCH,QAAjC,CAAX;AACD;;AAED,SAAOG,QAAP;AACD,C;;AAhED;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AACA,IAAIJ,iBAAJ;AAVA;AACA;;AAWA,SAASW,sBAAT,CAAgCP,QAAhC,EAA0CR,OAA1C,EAAmD;AACjD,MAAMgB,MAAMR,SAASS,OAAT,CAAiBjB,OAAjB,CAAZ;AACA,MAAIgB,MAAM,CAAV,EAAa;AACX,QAAME,MAAMV,SAASW,MAAT,CAAgBH,GAAhB,EAAqB,CAArB,CAAZ;AACA,WAAOE,IAAIE,MAAJ,CAAWZ,QAAX,CAAP;AACD;;AAED,SAAOA,QAAP;AACD;;AAED,SAASM,YAAT,CAAsBN,QAAtB,EAAgCH,QAAhC,EAA0C;AACxC,MAAID,SAASiB,4BAAb,EAA2C;AACzC;AACA;AACA;AACAb,eAAW,2BAASA,QAAT,EAAmBH,QAAnB,CAAX;AACD;;AAEDG,aAAW,2BAAaA,QAAb,CAAX;AACA,SAAOA,QAAP;AACD","file":"tabsequence.js","sourcesContent":["\r\n// https://www.w3.org/TR/html5/editing.html#sequential-focus-navigation-and-the-tabindex-attribute\r\n// https://www.w3.org/WAI/PF/aria-practices/#keyboard\r\n\r\nimport queryTabbable from './tabbable';\r\nimport nodeArray from '../util/node-array';\r\nimport platform from '../util/platform';\r\nimport sortArea from './tabsequence.sort-area';\r\nimport sortShadowed from './tabsequence.sort-shadowed';\r\nimport sortTabindex from './tabsequence.sort-tabindex';\r\nimport _supports from '../supports/supports';\r\nlet supports;\r\n\r\nfunction moveContextToBeginning(elements, context) {\r\n  const pos = elements.indexOf(context);\r\n  if (pos > 0) {\r\n    const tmp = elements.splice(pos, 1);\r\n    return tmp.concat(elements);\r\n  }\r\n\r\n  return elements;\r\n}\r\n\r\nfunction sortElements(elements, _context) {\r\n  if (supports.tabsequenceAreaAtImgPosition) {\r\n    // Some browsers sort <area> in DOM order, some place the <area>s\r\n    // where the <img> referecing them would've been in DOM order.\r\n    // https://github.com/medialize/ally.js/issues/5\r\n    elements = sortArea(elements, _context);\r\n  }\r\n\r\n  elements = sortTabindex(elements);\r\n  return elements;\r\n}\r\n\r\nexport default function({\r\n  context,\r\n  includeContext,\r\n  includeOnlyTabbable,\r\n  strategy,\r\n} = {}) {\r\n  if (!supports) {\r\n    supports = _supports();\r\n  }\r\n\r\n  const _context = nodeArray(context)[0] || document.documentElement;\r\n  let elements = queryTabbable({\r\n    context: _context,\r\n    includeContext,\r\n    includeOnlyTabbable,\r\n    strategy,\r\n  });\r\n\r\n  if (document.body.createShadowRoot && platform.is.BLINK) {\r\n    // sort tabindex localized to shadow dom\r\n    // see https://github.com/medialize/ally.js/issues/6\r\n    elements = sortShadowed(elements, _context, sortElements);\r\n  } else {\r\n    elements = sortElements(elements, _context);\r\n  }\r\n\r\n  if (includeContext) {\r\n    // if we include the context itself, it has to be the first\r\n    // element of the sequence\r\n    elements = moveContextToBeginning(elements, _context);\r\n  }\r\n\r\n  return elements;\r\n}\r\n"]}