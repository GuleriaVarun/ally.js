{"version":3,"sources":["../../src/supports/detect-focus.js"],"names":["platform","before","data","activeElement","document","windowScrollTop","window","scrollTop","windowScrollLeft","scrollLeft","bodyScrollTop","body","bodyScrollLeft","iframe","createElement","setAttribute","appendChild","_window","contentWindow","_document","open","close","wrapper","test","options","innerHTML","element","focus","mutate","parentNode","validate","after","blur","is","IE10","removeChild","tests","results","Object","keys","map","key"],"mappings":"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","file":"detect-focus.js","sourcesContent":["\r\nimport platform from '../util/platform';\r\n\r\nfunction before() {\r\n  const data = {\r\n    // remember what had focus to restore after test\r\n    activeElement: document.activeElement,\r\n    // remember scroll positions to restore after test\r\n    windowScrollTop: window.scrollTop,\r\n    windowScrollLeft: window.scrollLeft,\r\n    bodyScrollTop: document.body.scrollTop,\r\n    bodyScrollLeft: document.body.scrollLeft,\r\n  };\r\n\r\n  // wrap tests in an element hidden from screen readers to prevent them\r\n  // from announcing focus, which can be quite irritating to the user\r\n  const iframe = document.createElement('iframe');\r\n  iframe.setAttribute('style', 'position:absolute; position:fixed; top:0; left:-2px; width:1px; height:1px; overflow:hidden;');\r\n  iframe.setAttribute('aria-live', 'off');\r\n  iframe.setAttribute('aria-busy', 'true');\r\n  iframe.setAttribute('aria-hidden', 'true');\r\n  document.body.appendChild(iframe);\r\n\r\n  const _window = iframe.contentWindow;\r\n  const _document = _window.document;\r\n\r\n  _document.open();\r\n  _document.close();\r\n  const wrapper = _document.createElement('div');\r\n  _document.body.appendChild(wrapper);\r\n\r\n  data.iframe = iframe;\r\n  data.wrapper = wrapper;\r\n  data.window = _window;\r\n  data.document = _document;\r\n\r\n  return data;\r\n}\r\n\r\n// options.element:\r\n//  {string} element name\r\n//  {function} callback(wrapper, document) to generate an element\r\n// options.mutate: (optional)\r\n//  {function} callback(element, wrapper, document) to manipulate element prior to focus-test.\r\n//             Can return DOMElement to define focus target (default: element)\r\n// options.validate: (optional)\r\n//  {function} callback(element, focusTarget, document) to manipulate test-result\r\nfunction test(data, options) {\r\n  // make sure we operate on a clean slate\r\n  data.wrapper.innerHTML = '';\r\n  // create dummy element to test focusability of\r\n  const element = typeof options.element === 'string'\r\n    ? data.document.createElement(options.element)\r\n    : options.element(data.wrapper, data.document);\r\n  // allow callback to further specify dummy element\r\n  // and optionally define element to focus\r\n  let focus = options.mutate && options.mutate(element, data.wrapper, data.document);\r\n  if (!focus && focus !== false) {\r\n    focus = element;\r\n  }\r\n  // element needs to be part of the DOM to be focusable\r\n  !element.parentNode && data.wrapper.appendChild(element);\r\n  // test if the element with invalid tabindex can be focused\r\n  focus && focus.focus && focus.focus();\r\n  // validate test's result\r\n  return options.validate\r\n    ? options.validate(element, focus, data.document)\r\n    : data.document.activeElement === focus;\r\n}\r\n\r\nfunction after(data) {\r\n  // restore focus to what it was before test and cleanup\r\n  if (data.activeElement === document.body) {\r\n    document.activeElement && document.activeElement.blur && document.activeElement.blur();\r\n    if (platform.is.IE10) {\r\n      // IE10 does not redirect focus to <body> when the activeElement is removed\r\n      document.body.focus();\r\n    }\r\n  } else {\r\n    data.activeElement && data.activeElement.focus && data.activeElement.focus();\r\n  }\r\n\r\n  document.body.removeChild(data.iframe);\r\n\r\n  // restore scroll position\r\n  window.scrollTop = data.windowScrollTop;\r\n  window.scrollLeft = data.windowScrollLeft;\r\n  document.body.scrollTop = data.bodyScrollTop;\r\n  document.body.scrollLeft = data.bodyScrollLeft;\r\n}\r\n\r\nexport default function(tests) {\r\n  const data = before();\r\n\r\n  const results = {};\r\n  Object.keys(tests).map(function(key) {\r\n    results[key] = test(data, tests[key]);\r\n  });\r\n\r\n  after(data);\r\n  return results;\r\n}\r\n"]}