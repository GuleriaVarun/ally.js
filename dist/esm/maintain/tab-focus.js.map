{"version":3,"sources":["../../src/maintain/tab-focus.js"],"names":["isActiveElement","queryTabsequence","whenKey","context","document","documentElement","event","preventDefault","sequence","backward","shiftKey","first","last","length","source","target","focus","currentIndex","found","some","element","index","offset"],"mappings":";AACA,OAAOA,eAAP,MAA4B,sBAA5B;AACA,OAAOC,gBAAP,MAA6B,sBAA7B;AACA,OAAOC,OAAP,MAAoB,aAApB;;AAEA,eAAe,YAA2B;AAAA,iFAAJ,EAAI;AAAA,MAAhBC,OAAgB,QAAhBA,OAAgB;;AACxC,MAAI,CAACA,OAAL,EAAc;AACZA,cAAUC,SAASC,eAAnB;AACD;;AAED;AACA;AACA;AACAJ;;AAEA,SAAOC,QAAQ;AACb;AACA;AACA,uBAAmB,qBAASI,KAAT,EAAgB;AACjC;AACAA,YAAMC,cAAN;;AAEA,UAAMC,WAAWP,iBAAiB;AAChCE;AADgC,OAAjB,CAAjB;;AAIA,UAAMM,WAAWH,MAAMI,QAAvB;AACA,UAAMC,QAAQH,SAAS,CAAT,CAAd;AACA,UAAMI,OAAOJ,SAASA,SAASK,MAAT,GAAkB,CAA3B,CAAb;;AAEA;AACA,UAAMC,SAASL,WAAWE,KAAX,GAAmBC,IAAlC;AACA,UAAMG,SAASN,WAAWG,IAAX,GAAkBD,KAAjC;AACA,UAAIX,gBAAgBc,MAAhB,CAAJ,EAA6B;AAC3BC,eAAOC,KAAP;AACA;AACD;;AAED;AACA,UAAIC,qBAAJ;AACA,UAAMC,QAAQV,SAASW,IAAT,CAAc,UAASC,OAAT,EAAkBC,KAAlB,EAAyB;AACnD,YAAI,CAACrB,gBAAgBoB,OAAhB,CAAL,EAA+B;AAC7B,iBAAO,KAAP;AACD;;AAEDH,uBAAeI,KAAf;AACA,eAAO,IAAP;AACD,OAPa,CAAd;;AASA,UAAI,CAACH,KAAL,EAAY;AACV;AACAP,cAAMK,KAAN;AACA;AACD;;AAED;AACA,UAAMM,SAASb,WAAW,CAAC,CAAZ,GAAgB,CAA/B;AACAD,eAASS,eAAeK,MAAxB,EAAgCN,KAAhC;AACD;AA3CY,GAAR,CAAP;AA6CD","file":"tab-focus.js","sourcesContent":["\r\nimport isActiveElement from '../is/active-element';\r\nimport queryTabsequence from '../query/tabsequence';\r\nimport whenKey from '../when/key';\r\n\r\nexport default function({ context } = {}) {\r\n  if (!context) {\r\n    context = document.documentElement;\r\n  }\r\n\r\n  // Make sure the supports tests are run before intercepting the Tab key,\r\n  // or IE10 and IE11 will fail to process the first Tab key event. Not\r\n  // limiting this warm-up to IE because it may be a problem elsewhere, too.\r\n  queryTabsequence();\r\n\r\n  return whenKey({\r\n    // Safari on OSX may require ALT+TAB to reach links,\r\n    // see https://github.com/medialize/ally.js/issues/146\r\n    '?alt+?shift+tab': function(event) {\r\n      // we're completely taking over the Tab key handling\r\n      event.preventDefault();\r\n\r\n      const sequence = queryTabsequence({\r\n        context,\r\n      });\r\n\r\n      const backward = event.shiftKey;\r\n      const first = sequence[0];\r\n      const last = sequence[sequence.length - 1];\r\n\r\n      // wrap around first to last, last to first\r\n      const source = backward ? first : last;\r\n      const target = backward ? last : first;\r\n      if (isActiveElement(source)) {\r\n        target.focus();\r\n        return;\r\n      }\r\n\r\n      // find current position in tabsequence\r\n      let currentIndex;\r\n      const found = sequence.some(function(element, index) {\r\n        if (!isActiveElement(element)) {\r\n          return false;\r\n        }\r\n\r\n        currentIndex = index;\r\n        return true;\r\n      });\r\n\r\n      if (!found) {\r\n        // redirect to first as we're not in our tabsequence\r\n        first.focus();\r\n        return;\r\n      }\r\n\r\n      // shift focus to previous/next element in the sequence\r\n      const offset = backward ? -1 : 1;\r\n      sequence[currentIndex + offset].focus();\r\n    },\r\n  });\r\n}\r\n"]}