{"version":3,"sources":["../../src/fix/pointer-focus-input.js"],"names":["getFocusTarget","decorateContext","elementMatches","platform","engage","disengage","relevantToCurrentBrowser","is","OSX","GECKO","WEBKIT","handleMouseDownEvent","event","defaultPrevented","target","context","window","setImmediate","setTimeout","focus","handleMouseUpEvent","element","addEventListener","removeEventListener"],"mappings":"AAAA;;;;;;;;;;;AAWA,OAAOA,cAAP,MAA2B,qBAA3B;AACA,OAAOC,eAAP,MAA4B,0BAA5B;AACA,OAAOC,cAAP,MAA2B,yBAA3B;AACA,OAAOC,QAAP,MAAqB,kBAArB;;AAEA,IAAIC,eAAJ;AACA,IAAIC,kBAAJ;AACA;AACA,IAAMC,2BAA2BH,SAASI,EAAT,CAAYC,GAAZ,KAAoBL,SAASI,EAAT,CAAYE,KAAZ,IAAqBN,SAASI,EAAT,CAAYG,MAArD,CAAjC;;AAEA,IAAI,CAACJ,wBAAL,EAA+B;AAC7BF,WAAS,kBAAW,CAAE,CAAtB;AACD,CAFD,MAEO;AACL,MAAMO,uBAAuB,SAAvBA,oBAAuB,CAASC,KAAT,EAAgB;AAC3C,QAAIA,MAAMC,gBAAN,IAA0B,CAACX,eAAeU,MAAME,MAArB,EAA6B,yBAA7B,CAA/B,EAAwF;AACtF;AACA;AACA;AACD;;AAED,QAAMA,SAASd,eAAe;AAC5Be,eAASH,MAAME;AADa,KAAf,CAAf;;AAIA;AACA,KAACE,OAAOC,YAAP,IAAuBD,OAAOE,UAA/B,EAA2C,YAAW;AACpDJ,aAAOK,KAAP;AACD,KAFD;AAGD,GAfD;;AAiBA,MAAMC,qBAAqB,SAArBA,kBAAqB,CAASR,KAAT,EAAgB;AACzC,QAAIA,MAAMC,gBAAN,IAA0B,CAACX,eAAeU,MAAME,MAArB,EAA6B,gBAA7B,CAA/B,EAA+E;AAC7E;AACA;AACA;AACD;;AAED,QAAMA,SAASd,eAAe;AAC5Be,eAASH,MAAME;AADa,KAAf,CAAf;;AAIA,QAAI,CAACA,MAAL,EAAa;AACX;AACD;;AAEDA,WAAOK,KAAP;AACD,GAhBD;;AAkBAf,WAAS,gBAASiB,OAAT,EAAkB;AACzBA,YAAQC,gBAAR,CAAyB,WAAzB,EAAsCX,oBAAtC,EAA4D,KAA5D;AACA;AACAU,YAAQC,gBAAR,CAAyB,SAAzB,EAAoCF,kBAApC,EAAwD,KAAxD;AACD,GAJD;;AAMAf,cAAY,mBAASgB,OAAT,EAAkB;AAC5BA,YAAQE,mBAAR,CAA4B,WAA5B,EAAyCZ,oBAAzC,EAA+D,KAA/D;AACAU,YAAQE,mBAAR,CAA4B,SAA5B,EAAuCH,kBAAvC,EAA2D,KAA3D;AACD,GAHD;AAID;;AAED,eAAenB,gBAAgB,EAAEG,cAAF,EAAUC,oBAAV,EAAhB,CAAf","file":"pointer-focus-input.js","sourcesContent":["/*\r\n  Clicking on form field does not necessarily assign it focus in Safari and Firefox on Mac OS X.\r\n  While not a browser bug, it may be considered undesired behavior.\r\n\r\n  https://bugs.webkit.org/show_bug.cgi?id=22261\r\n  https://bugs.webkit.org/show_bug.cgi?id=118043\r\n\r\n  Note: This behavior can be turned off in Firefox by changing the\r\n  option `accessibility.mouse_focuses_formcontrol` in about:config\r\n*/\r\n\r\nimport getFocusTarget from '../get/focus-target';\r\nimport decorateContext from '../util/decorate-context';\r\nimport elementMatches from '../util/element-matches';\r\nimport platform from '../util/platform';\r\n\r\nlet engage;\r\nlet disengage;\r\n// This fix is only relevant to Safari and Firefox on OSX\r\nconst relevantToCurrentBrowser = platform.is.OSX && (platform.is.GECKO || platform.is.WEBKIT);\r\n\r\nif (!relevantToCurrentBrowser) {\r\n  engage = function() {};\r\n} else {\r\n  const handleMouseDownEvent = function(event) {\r\n    if (event.defaultPrevented || !elementMatches(event.target, 'input, button, button *')) {\r\n      // abort if the mousedown event was cancelled,\r\n      // or we're not dealing with an affected form control\r\n      return;\r\n    }\r\n\r\n    const target = getFocusTarget({\r\n      context: event.target,\r\n    });\r\n\r\n    // we need to set focus AFTER the mousedown finished, otherwise WebKit will ignore the call\r\n    (window.setImmediate || window.setTimeout)(function() {\r\n      target.focus();\r\n    });\r\n  };\r\n\r\n  const handleMouseUpEvent = function(event) {\r\n    if (event.defaultPrevented || !elementMatches(event.target, 'label, label *')) {\r\n      // abort if the mouseup event was cancelled,\r\n      // or we're not dealing with a <label>\r\n      return;\r\n    }\r\n\r\n    const target = getFocusTarget({\r\n      context: event.target,\r\n    });\r\n\r\n    if (!target) {\r\n      return;\r\n    }\r\n\r\n    target.focus();\r\n  };\r\n\r\n  engage = function(element) {\r\n    element.addEventListener('mousedown', handleMouseDownEvent, false);\r\n    // <label> elements redirect focus upon mouseup, not mousedown\r\n    element.addEventListener('mouseup', handleMouseUpEvent, false);\r\n  };\r\n\r\n  disengage = function(element) {\r\n    element.removeEventListener('mousedown', handleMouseDownEvent, false);\r\n    element.removeEventListener('mouseup', handleMouseUpEvent, false);\r\n  };\r\n}\r\n\r\nexport default decorateContext({ engage, disengage });\r\n"]}