{"version":3,"sources":["../../src/query/tabsequence.sort-area.js"],"names":["queryTabbable","mergeInDomOrder","getDocument","getMapByName","Maps","context","_document","maps","name","addMapByName","map","elements","filter","element","nodeName","toLowerCase","parentNode","push","usemaps","querySelectorAll","_elements","extractAreasFromList","length","list","resolveElement","image","getAttribute","slice","getAreasFor"],"mappings":";;;;AACA;;AAEA,OAAOA,aAAP,MAA0B,YAA1B;AACA,OAAOC,eAAP,MAA4B,yBAA5B;AACA,OAAOC,WAAP,MAAwB,sBAAxB;AACA,SAAQC,YAAR,QAA2B,mBAA3B;;IAEMC,I;AACJ,gBAAYC,OAAZ,EAAqB;AAAA;;AACnB,SAAKC,SAAL,GAAiBJ,YAAYG,OAAZ,CAAjB;AACA,SAAKE,IAAL,GAAY,EAAZ;AACD;;;;gCAEWC,I,EAAM;AAChB,UAAI,CAAC,KAAKD,IAAL,CAAUC,IAAV,CAAL,EAAsB;AACpB;AACA;AACA,aAAKC,YAAL,CAAkBD,IAAlB;AACD;;AAED,aAAO,KAAKD,IAAL,CAAUC,IAAV,CAAP;AACD;;;iCAEYA,I,EAAM;AACjB,UAAME,MAAMP,aAAaK,IAAb,EAAmB,KAAKF,SAAxB,CAAZ;AACA,UAAI,CAACI,GAAL,EAAU;AACR;AACA;AACD;;AAED,WAAKH,IAAL,CAAUG,IAAIF,IAAd,IAAsBR,cAAc,EAACK,SAASK,GAAV,EAAd,CAAtB;AACD;;;yCAEoBC,Q,EAAU;AAC7B;AACA;AACA,aAAOA,SAASC,MAAT,CAAgB,UAASC,OAAT,EAAkB;AACvC,YAAMC,WAAWD,QAAQC,QAAR,CAAiBC,WAAjB,EAAjB;AACA,YAAID,aAAa,MAAjB,EAAyB;AACvB,iBAAO,IAAP;AACD;;AAED,YAAMJ,MAAMG,QAAQG,UAApB;AACA,YAAI,CAAC,KAAKT,IAAL,CAAUG,IAAIF,IAAd,CAAL,EAA0B;AACxB,eAAKD,IAAL,CAAUG,IAAIF,IAAd,IAAsB,EAAtB;AACD;;AAED,aAAKD,IAAL,CAAUG,IAAIF,IAAd,EAAoBS,IAApB,CAAyBJ,OAAzB;AACA,eAAO,KAAP;AACD,OAbM,EAaJ,IAbI,CAAP;AAcD;;;;;;AAGH,eAAe,UAASF,QAAT,EAAmBN,OAAnB,EAA4B;AACzC;AACA;AACA;AACA,MAAMa,UAAUb,QAAQc,gBAAR,CAAyB,aAAzB,CAAhB;AACA,MAAMZ,OAAO,IAAIH,IAAJ,CAASC,OAAT,CAAb;;AAEA;AACA;AACA,MAAMe,YAAYb,KAAKc,oBAAL,CAA0BV,QAA1B,CAAlB;;AAEA,MAAI,CAACO,QAAQI,MAAb,EAAqB;AACnB;AACA;AACA,WAAOF,SAAP;AACD;;AAED,SAAOnB,gBAAgB;AACrBsB,UAAMH,SADe;AAErBT,cAAUO,OAFW;AAGrBM,oBAAgB,wBAASC,KAAT,EAAgB;AAC9B,UAAMjB,OAAOiB,MAAMC,YAAN,CAAmB,QAAnB,EAA6BC,KAA7B,CAAmC,CAAnC,CAAb;AACA,aAAOpB,KAAKqB,WAAL,CAAiBpB,IAAjB,CAAP;AACD;AANoB,GAAhB,CAAP;AAQD","file":"tabsequence.sort-area.js","sourcesContent":["\r\n// move <area> elements to the location of the <img> elements that reference them\r\n\r\nimport queryTabbable from './tabbable';\r\nimport mergeInDomOrder from '../util/merge-dom-order';\r\nimport getDocument from '../util/get-document';\r\nimport {getMapByName} from '../util/image-map';\r\n\r\nclass Maps {\r\n  constructor(context) {\r\n    this._document = getDocument(context);\r\n    this.maps = {};\r\n  }\r\n\r\n  getAreasFor(name) {\r\n    if (!this.maps[name]) {\r\n      // the map is not defined within the context, so we\r\n      // have to go find it elsewhere in the document\r\n      this.addMapByName(name);\r\n    }\r\n\r\n    return this.maps[name];\r\n  }\r\n\r\n  addMapByName(name) {\r\n    const map = getMapByName(name, this._document);\r\n    if (!map) {\r\n      // if there is no map, the img[usemap] wasn't doing anything anyway\r\n      return;\r\n    }\r\n\r\n    this.maps[map.name] = queryTabbable({context: map});\r\n  }\r\n\r\n  extractAreasFromList(elements) {\r\n    // remove all <area> elements from the elements list,\r\n    // but put them the map for later retrieval\r\n    return elements.filter(function(element) {\r\n      const nodeName = element.nodeName.toLowerCase();\r\n      if (nodeName !== 'area') {\r\n        return true;\r\n      }\r\n\r\n      const map = element.parentNode;\r\n      if (!this.maps[map.name]) {\r\n        this.maps[map.name] = [];\r\n      }\r\n\r\n      this.maps[map.name].push(element);\r\n      return false;\r\n    }, this);\r\n  }\r\n}\r\n\r\nexport default function(elements, context) {\r\n  // images - unless they are focusable themselves, likely not\r\n  // part of the elements list, so we'll have to find them and\r\n  // sort them into the elements list manually\r\n  const usemaps = context.querySelectorAll('img[usemap]');\r\n  const maps = new Maps(context);\r\n\r\n  // remove all <area> elements from the elements list,\r\n  // but put them the map for later retrieval\r\n  const _elements = maps.extractAreasFromList(elements);\r\n\r\n  if (!usemaps.length) {\r\n    // the context does not contain any <area>s so no need\r\n    // to replace anything, just remove any maps\r\n    return _elements;\r\n  }\r\n\r\n  return mergeInDomOrder({\r\n    list: _elements,\r\n    elements: usemaps,\r\n    resolveElement: function(image) {\r\n      const name = image.getAttribute('usemap').slice(1);\r\n      return maps.getAreasFor(name);\r\n    },\r\n  });\r\n}\r\n"]}