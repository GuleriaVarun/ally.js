{"version":3,"sources":["../../src/element/disabled.js"],"names":["contextToElement","tabindexValue","isNativeDisabledSupported","toggleAttribute","toggleAttributeValue","logger","_supports","supports","disabledFocus","warn","disableTabindex","element","disabledState","tabIndex","attribute","temporaryValue","saveValue","disableVideoControls","remove","disableSvgFocusable","undefined","disableSvgLink","setAriaDisabled","disableScriptFocus","focus","disablePointerEvents","pointerEvents","style","setAttribute","getAttribute","removeAttribute","setElementDisabled","nodeName","toLowerCase","ownerSVGElement","focusSvgFocusableAttribute","focusSvgTabindexAttribute","context","label","Boolean","currentState","hasAttribute","runningAsGetter","arguments","length","disabled"],"mappings":"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","file":"disabled.js","sourcesContent":["\r\n/*\r\n  Utility to make any element inert (disabled). Inert means the elements cannot be interacted\r\n  with and they cannot be focused via script, pointer or keyboard - and thus not receive focus.\r\n\r\n  Elements made inert (disabled) by this utility are given the attribute [data-ally-disabled=\"true\"].\r\n\r\n  ---------------\r\n\r\n  inert attribute was [removed](https://html5.org/r/8536) [tweet by steve](https://twitter.com/stevefaulkner/status/443075900201259008)\r\n  but definition of [inert subtrees](https://www.w3.org/html/wg/drafts/html/master/editing.html#inert-subtrees) remains.\r\n\r\n  [implementation idea by Vasilis](https://codepen.io/vasilisvg/pen/scowI)\r\n  [inert attribute polyfill by GoogleChrome](https://github.com/GoogleChrome/inert-polyfill)\r\n\r\n  [Gecko Bug: Inert Attribute](https://bugzilla.mozilla.org/show_bug.cgi?id=921504)\r\n  [Chromium Bug: Inert Attribute](https://code.google.com/p/chromium/issues/detail?id=269846)\r\n  [Chromium Bug: Inert Subtree](https://code.google.com/p/chromium/issues/detail?id=241699)\r\n  [WebKit Bug: Inert Subtree](https://bugs.webkit.org/show_bug.cgi?id=110952)\r\n*/\r\n\r\nimport contextToElement from '../util/context-to-element';\r\nimport tabindexValue from '../util/tabindex-value';\r\nimport isNativeDisabledSupported from '../is/native-disabled-supported';\r\nimport toggleAttribute from '../util/toggle-attribute';\r\nimport toggleAttributeValue from '../util/toggle-attribute-value';\r\nimport logger from '../util/logger';\r\n\r\nimport _supports from '../supports/supports';\r\nlet supports;\r\n\r\nfunction disabledFocus() {\r\n  logger.warn('trying to focus inert element', this);\r\n}\r\n\r\nfunction disableTabindex(element, disabledState) {\r\n  if (disabledState) {\r\n    const tabIndex = tabindexValue(element);\r\n    toggleAttributeValue({\r\n      element,\r\n      attribute: 'tabindex',\r\n      temporaryValue: '-1',\r\n      saveValue: tabIndex !== null ? tabIndex : '',\r\n    });\r\n  } else {\r\n    toggleAttributeValue({\r\n      element,\r\n      attribute: 'tabindex',\r\n    });\r\n  }\r\n}\r\n\r\nfunction disableVideoControls(element, disabledState) {\r\n  toggleAttribute({\r\n    element,\r\n    attribute: 'controls',\r\n    remove: disabledState,\r\n  });\r\n}\r\n\r\nfunction disableSvgFocusable(element, disabledState) {\r\n  toggleAttributeValue({\r\n    element,\r\n    attribute: 'focusable',\r\n    temporaryValue: disabledState ? 'false' : undefined,\r\n  });\r\n}\r\n\r\nfunction disableSvgLink(element, disabledState) {\r\n  toggleAttribute({\r\n    element,\r\n    attribute: 'xlink:href',\r\n    remove: disabledState,\r\n  });\r\n}\r\n\r\nfunction setAriaDisabled(element, disabledState) {\r\n  toggleAttributeValue({\r\n    element,\r\n    attribute: 'aria-disabled',\r\n    temporaryValue: disabledState ? 'true' : undefined,\r\n  });\r\n}\r\n\r\nfunction disableScriptFocus(element, disabledState) {\r\n  if (disabledState) {\r\n    // make sure no script can focus the element\r\n    element.focus = disabledFocus;\r\n  } else {\r\n    // restore original focus function from prototype\r\n    delete element.focus;\r\n  }\r\n}\r\n\r\nfunction disablePointerEvents(element, disabledState) {\r\n  if (disabledState) {\r\n    // remember previous pointer events status so we can restore it\r\n    const pointerEvents = element.style.pointerEvents || '';\r\n    element.setAttribute('data-inert-pointer-events', pointerEvents);\r\n    // make sure no pointer interaction can access the element\r\n    element.style.pointerEvents = 'none';\r\n  } else {\r\n    // restore to previous pointer interaction status\r\n    const pointerEvents = element.getAttribute('data-inert-pointer-events');\r\n    element.removeAttribute('data-inert-pointer-events');\r\n    element.style.pointerEvents = pointerEvents;\r\n  }\r\n}\r\n\r\nfunction setElementDisabled(element, disabledState) {\r\n  setAriaDisabled(element, disabledState);\r\n  disableTabindex(element, disabledState);\r\n  disableScriptFocus(element, disabledState);\r\n  disablePointerEvents(element, disabledState);\r\n\r\n  const nodeName = element.nodeName.toLowerCase();\r\n  if (nodeName === 'video' || nodeName === 'audio') {\r\n    // Blink and Gecko leave <video controls tabindex=\"-1\"> in document focus navigation sequence\r\n    // Blink leaves <audio controls tabindex=\"-1\"> in document focus navigation sequence\r\n    disableVideoControls(element, disabledState);\r\n  }\r\n\r\n  if (nodeName === 'svg' || element.ownerSVGElement) {\r\n    if (supports.focusSvgFocusableAttribute) {\r\n      // Internet Explorer knows focusable=\"false\" instead of tabindex=\"-1\"\r\n      disableSvgFocusable(element, disabledState);\r\n    } else if (!supports.focusSvgTabindexAttribute && nodeName === 'a') {\r\n      // Firefox neither knows focusable=\"false\" nor tabindex=\"-1\"\r\n      disableSvgLink(element, disabledState);\r\n    }\r\n  }\r\n\r\n  if (disabledState) {\r\n    element.setAttribute('data-ally-disabled', 'true');\r\n  } else {\r\n    element.removeAttribute('data-ally-disabled');\r\n  }\r\n}\r\n\r\nexport default function(context, disabledState) {\r\n  if (!supports) {\r\n    supports = _supports();\r\n  }\r\n\r\n  const element = contextToElement({\r\n    label: 'element/disabled',\r\n    context,\r\n  });\r\n\r\n  // accept truthy/falsy values\r\n  disabledState = Boolean(disabledState);\r\n  const currentState = element.hasAttribute('data-ally-disabled');\r\n  // if there's no value to set, we're running as a getter\r\n  const runningAsGetter = arguments.length === 1;\r\n\r\n  if (isNativeDisabledSupported(element)) {\r\n    if (runningAsGetter) {\r\n      return element.disabled;\r\n    }\r\n\r\n    // form elements know the disabled attribute, which we shall use instead of our poor man's copy of it\r\n    element.disabled = disabledState;\r\n    return element;\r\n  }\r\n\r\n  if (runningAsGetter) {\r\n    return currentState;\r\n  }\r\n\r\n  if (currentState === disabledState) {\r\n    // no update necessary\r\n    return element;\r\n  }\r\n\r\n  setElementDisabled(element, disabledState);\r\n  return element;\r\n}\r\n"]}