{"version":3,"sources":["../../src/element/focus.js"],"names":["focusSvgForeignObjectHack","getFocusTarget","isActiveElement","isFocusable","contextToElement","getWindow","resetScrolling","focus","element","_window","HTMLElement","prototype","call","e","actionPerformed","except","flexbox","scrollable","onlyTabbable","context","defaultToAncestor","undoScrolling","label","targetIsFocusable","rules","target","_undoScrolling","result"],"mappings":";AACA;;AAEA,OAAOA,yBAAP,MAAsC,iCAAtC;AACA,OAAOC,cAAP,MAA2B,qBAA3B;AACA,OAAOC,eAAP,MAA4B,sBAA5B;AACA,OAAOC,WAAP,MAAwB,iBAAxB;AACA,OAAOC,gBAAP,MAA6B,4BAA7B;AACA,OAAOC,SAAP,MAAsB,oBAAtB;AACA,OAAOC,cAAP,MAA2B,yBAA3B;;AAEA,SAASC,KAAT,CAAeC,OAAf,EAAwB;AACtB,MAAIA,QAAQD,KAAZ,EAAmB;AACjBC,YAAQD,KAAR;AACA,WAAOL,gBAAgBM,OAAhB,IAA2BA,OAA3B,GAAqC,IAA5C;AACD;;AAED,MAAMC,UAAUJ,UAAUG,OAAV,CAAhB;;AAEA,MAAI;AACF;AACA;AACA;AACA;AACA;AACAC,YAAQC,WAAR,CAAoBC,SAApB,CAA8BJ,KAA9B,CAAoCK,IAApC,CAAyCJ,OAAzC;AACA,WAAON,gBAAgBM,OAAhB,IAA2BA,OAA3B,GAAqC,IAA5C;AACD,GARD,CAQE,OAAOK,CAAP,EAAU;AACV,QAAMC,kBAAkBd,0BAA0BQ,OAA1B,CAAxB;AACA,WAAOM,mBAAmBZ,gBAAgBM,OAAhB,CAAnB,GAA8CA,OAA9C,GAAwD,IAA/D;AACD;AACF;;AAED,IAAMO,SAAS;AACb;AACAC,WAAS,IAFI;AAGb;AACA;AACAC,cAAY,IALC;AAMb;AACAC,gBAAc;AAPD,CAAf;;AAUA,eAAe,UAASC,OAAT,EAGP;AAAA,iFAAJ,EAAI;AAAA,MAFNC,iBAEM,QAFNA,iBAEM;AAAA,MADNC,aACM,QADNA,aACM;;AACN,MAAMb,UAAUJ,iBAAiB;AAC/BkB,WAAO,eADwB;AAE/BH;AAF+B,GAAjB,CAAhB;;AAKA,MAAMI,oBAAoBpB,YAAYqB,KAAZ,CAAkB;AAC1CL,aAASX,OADiC;AAE1CO;AAF0C,GAAlB,CAA1B;;AAKA,MAAI,CAACK,iBAAD,IAAsB,CAACG,iBAA3B,EAA8C;AAC5C,WAAO,IAAP;AACD;;AAED,MAAME,SAASxB,eAAe;AAC5BkB,aAASX,OADmB;AAE5BO;AAF4B,GAAf,CAAf;;AAKA,MAAI,CAACU,MAAL,EAAa;AACX,WAAO,IAAP;AACD;;AAED,MAAIvB,gBAAgBuB,MAAhB,CAAJ,EAA6B;AAC3B,WAAOA,MAAP;AACD;;AAED,MAAIC,uBAAJ;AACA,MAAIL,aAAJ,EAAmB;AACjBK,qBAAiBpB,eAAemB,MAAf,CAAjB;AACD;;AAED,MAAME,SAASpB,MAAMkB,MAAN,CAAf;;AAEAC,oBAAkBA,gBAAlB;;AAEA,SAAOC,MAAP;AACD","file":"focus.js","sourcesContent":["\r\n// wrapper for HTMLElement.prototype.focus\r\n\r\nimport focusSvgForeignObjectHack from './focus.svg-foreign-object-hack';\r\nimport getFocusTarget from '../get/focus-target';\r\nimport isActiveElement from '../is/active-element';\r\nimport isFocusable from '../is/focusable';\r\nimport contextToElement from '../util/context-to-element';\r\nimport getWindow from '../util/get-window';\r\nimport resetScrolling from '../util/reset-scrolling';\r\n\r\nfunction focus(element) {\r\n  if (element.focus) {\r\n    element.focus();\r\n    return isActiveElement(element) ? element : null;\r\n  }\r\n\r\n  const _window = getWindow(element);\r\n\r\n  try {\r\n    // The element itself does not have a focus method.\r\n    // This is true for SVG elements in Firefox and IE,\r\n    // as well as MathML elements in every browser.\r\n    // IE9 - 11 will let us abuse HTMLElement's focus method,\r\n    // Firefox and Edge will throw an error.\r\n    _window.HTMLElement.prototype.focus.call(element);\r\n    return isActiveElement(element) ? element : null;\r\n  } catch (e) {\r\n    const actionPerformed = focusSvgForeignObjectHack(element);\r\n    return actionPerformed && isActiveElement(element) ? element : null;\r\n  }\r\n}\r\n\r\nconst except = {\r\n  // exclude elements affected by the IE flexbox bug\r\n  flexbox: true,\r\n  // exclude overflowing elements that are not intentionally\r\n  // made focusable by adding a tabindex attribute\r\n  scrollable: true,\r\n  // include elements that don't have a focus() method\r\n  onlyTabbable: true,\r\n};\r\n\r\nexport default function(context, {\r\n  defaultToAncestor,\r\n  undoScrolling,\r\n} = {}) {\r\n  const element = contextToElement({\r\n    label: 'element/focus',\r\n    context,\r\n  });\r\n\r\n  const targetIsFocusable = isFocusable.rules({\r\n    context: element,\r\n    except,\r\n  });\r\n\r\n  if (!defaultToAncestor && !targetIsFocusable) {\r\n    return null;\r\n  }\r\n\r\n  const target = getFocusTarget({\r\n    context: element,\r\n    except,\r\n  });\r\n\r\n  if (!target) {\r\n    return null;\r\n  }\r\n\r\n  if (isActiveElement(target)) {\r\n    return target;\r\n  }\r\n\r\n  let _undoScrolling;\r\n  if (undoScrolling) {\r\n    _undoScrolling = resetScrolling(target);\r\n  }\r\n\r\n  const result = focus(target);\r\n\r\n  _undoScrolling && _undoScrolling();\r\n\r\n  return result;\r\n}\r\n"]}