{"version":3,"sources":["../../src/is/visible.js"],"names":["notRenderedElementsPattern","computedStyle","element","property","window","getComputedStyle","getPropertyValue","notDisplayed","_path","some","notVisible","hidden","visibility","visible","collapsedParent","offset","nodeName","toLowerCase","slice","open","isVisibleRules","context","except","notRendered","cssDisplay","cssVisibility","detailsElement","browsingContext","label","resolveDocument","test","isAudioWithoutControls","hasAttribute","frameElement","_isVisible","isVisible","rules"],"mappings":"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","file":"visible.js","sourcesContent":["\r\n// determine if an element is rendered\r\n// NOTE: that does not mean an element is visible in the viewport, see util/visible-area\r\n\r\nimport findIndex from '../util/array-find-index';\r\nimport getParents from '../get/parents';\r\nimport contextToElement from '../util/context-to-element';\r\nimport getFrameElement from '../util/get-frame-element';\r\n\r\n// https://www.w3.org/TR/html5/rendering.html#being-rendered\r\n// <area> is not rendered, but we *consider* it visible to simplfiy this function's usage\r\nconst notRenderedElementsPattern = /^(area)$/;\r\n\r\nfunction computedStyle(element, property) {\r\n  return window.getComputedStyle(element, null)\r\n    .getPropertyValue(property);\r\n}\r\n\r\nfunction notDisplayed(_path) {\r\n  return _path.some(function(element) {\r\n    // display:none is not visible (optimized away at layout)\r\n    return computedStyle(element, 'display') === 'none';\r\n  });\r\n}\r\n\r\nfunction notVisible(_path) {\r\n  // https://github.com/jquery/jquery-ui/blob/master/ui/core.js#L109-L114\r\n  // NOTE: a nested element can reverse visibility:hidden|collapse by explicitly setting visibility:visible\r\n  // NOTE: visibility can be [\"\", \"visible\", \"hidden\", \"collapse\"]\r\n  const hidden = findIndex(_path, function(element) {\r\n    const visibility = computedStyle(element, 'visibility');\r\n    return visibility === 'hidden' || visibility === 'collapse';\r\n  });\r\n\r\n  if (hidden === -1) {\r\n    // there is no hidden element\r\n    return false;\r\n  }\r\n\r\n  const visible = findIndex(_path, function(element) {\r\n    return computedStyle(element, 'visibility') === 'visible';\r\n  });\r\n\r\n  if (visible === -1) {\r\n    // there is no visible element (but a hidden element)\r\n    return true;\r\n  }\r\n\r\n  if (hidden < visible) {\r\n    // there is a hidden element and it's closer than the first visible element\r\n    return true;\r\n  }\r\n\r\n  // there may be a hidden element, but the closest element is visible\r\n  return false;\r\n}\r\n\r\nfunction collapsedParent(_path) {\r\n  let offset = 1;\r\n  if (_path[0].nodeName.toLowerCase() === 'summary') {\r\n    offset = 2;\r\n  }\r\n\r\n  return _path.slice(offset).some(function(element) {\r\n    // \"content children\" of a closed details element are not visible\r\n    return element.nodeName.toLowerCase() === 'details' && element.open === false;\r\n  });\r\n}\r\n\r\nfunction isVisibleRules({\r\n  context,\r\n  except = {\r\n    notRendered: false,\r\n    cssDisplay: false,\r\n    cssVisibility: false,\r\n    detailsElement: false,\r\n    browsingContext: false,\r\n  },\r\n} = {}) {\r\n  const element = contextToElement({\r\n    label: 'is/visible',\r\n    resolveDocument: true,\r\n    context,\r\n  });\r\n\r\n  const nodeName = element.nodeName.toLowerCase();\r\n  if (!except.notRendered && notRenderedElementsPattern.test(nodeName)) {\r\n    return true;\r\n  }\r\n\r\n  const _path = getParents({context: element});\r\n\r\n  // in Internet Explorer <audio> has a default display: none, where others have display: inline\r\n  // but IE allows focusing <audio style=\"display:none\">, but not <div display:none><audio>\r\n  // this is irrelevant to other browsers, as the controls attribute is required to make <audio> focusable\r\n  const isAudioWithoutControls = nodeName === 'audio' && !element.hasAttribute('controls');\r\n  if (!except.cssDisplay && notDisplayed(isAudioWithoutControls ? _path.slice(1) : _path)) {\r\n    return false;\r\n  }\r\n\r\n  if (!except.cssVisibility && notVisible(_path)) {\r\n    return false;\r\n  }\r\n\r\n  if (!except.detailsElement && collapsedParent(_path)) {\r\n    return false;\r\n  }\r\n\r\n  if (!except.browsingContext) {\r\n    // elements within a browsing context are affected by the\r\n    // browsing context host element's visibility and tabindex\r\n    const frameElement = getFrameElement(element);\r\n    const _isVisible = isVisibleRules.except(except);\r\n    if (frameElement && !_isVisible(frameElement)) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n\r\n// bind exceptions to an iterator callback\r\nisVisibleRules.except = function(except = {}) {\r\n  const isVisible = function(context) {\r\n    return isVisibleRules({\r\n      context,\r\n      except,\r\n    });\r\n  };\r\n\r\n  isVisible.rules = isVisibleRules;\r\n  return isVisible;\r\n};\r\n\r\n// provide isVisible(context) as default iterator callback\r\nconst isVisible = isVisibleRules.except({});\r\nexport default isVisible;\r\n"]}