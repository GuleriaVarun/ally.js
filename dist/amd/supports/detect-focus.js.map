{"version":3,"sources":["../../src/supports/detect-focus.js"],"names":["tests","data","before","results","Object","keys","map","key","test","after","activeElement","document","windowScrollTop","window","scrollTop","windowScrollLeft","scrollLeft","bodyScrollTop","body","bodyScrollLeft","iframe","createElement","setAttribute","appendChild","_window","contentWindow","_document","open","close","wrapper","options","innerHTML","element","focus","mutate","parentNode","validate","blur","platform","is","IE10","removeChild"],"mappings":"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","file":"detect-focus.js","sourcesContent":["\r\nimport platform from '../util/platform';\r\n\r\nfunction before() {\r\n  const data = {\r\n    // remember what had focus to restore after test\r\n    activeElement: document.activeElement,\r\n    // remember scroll positions to restore after test\r\n    windowScrollTop: window.scrollTop,\r\n    windowScrollLeft: window.scrollLeft,\r\n    bodyScrollTop: document.body.scrollTop,\r\n    bodyScrollLeft: document.body.scrollLeft,\r\n  };\r\n\r\n  // wrap tests in an element hidden from screen readers to prevent them\r\n  // from announcing focus, which can be quite irritating to the user\r\n  const iframe = document.createElement('iframe');\r\n  iframe.setAttribute('style', 'position:absolute; position:fixed; top:0; left:-2px; width:1px; height:1px; overflow:hidden;');\r\n  iframe.setAttribute('aria-live', 'off');\r\n  iframe.setAttribute('aria-busy', 'true');\r\n  iframe.setAttribute('aria-hidden', 'true');\r\n  document.body.appendChild(iframe);\r\n\r\n  const _window = iframe.contentWindow;\r\n  const _document = _window.document;\r\n\r\n  _document.open();\r\n  _document.close();\r\n  const wrapper = _document.createElement('div');\r\n  _document.body.appendChild(wrapper);\r\n\r\n  data.iframe = iframe;\r\n  data.wrapper = wrapper;\r\n  data.window = _window;\r\n  data.document = _document;\r\n\r\n  return data;\r\n}\r\n\r\n// options.element:\r\n//  {string} element name\r\n//  {function} callback(wrapper, document) to generate an element\r\n// options.mutate: (optional)\r\n//  {function} callback(element, wrapper, document) to manipulate element prior to focus-test.\r\n//             Can return DOMElement to define focus target (default: element)\r\n// options.validate: (optional)\r\n//  {function} callback(element, focusTarget, document) to manipulate test-result\r\nfunction test(data, options) {\r\n  // make sure we operate on a clean slate\r\n  data.wrapper.innerHTML = '';\r\n  // create dummy element to test focusability of\r\n  const element = typeof options.element === 'string'\r\n    ? data.document.createElement(options.element)\r\n    : options.element(data.wrapper, data.document);\r\n  // allow callback to further specify dummy element\r\n  // and optionally define element to focus\r\n  let focus = options.mutate && options.mutate(element, data.wrapper, data.document);\r\n  if (!focus && focus !== false) {\r\n    focus = element;\r\n  }\r\n  // element needs to be part of the DOM to be focusable\r\n  !element.parentNode && data.wrapper.appendChild(element);\r\n  // test if the element with invalid tabindex can be focused\r\n  focus && focus.focus && focus.focus();\r\n  // validate test's result\r\n  return options.validate\r\n    ? options.validate(element, focus, data.document)\r\n    : data.document.activeElement === focus;\r\n}\r\n\r\nfunction after(data) {\r\n  // restore focus to what it was before test and cleanup\r\n  if (data.activeElement === document.body) {\r\n    document.activeElement && document.activeElement.blur && document.activeElement.blur();\r\n    if (platform.is.IE10) {\r\n      // IE10 does not redirect focus to <body> when the activeElement is removed\r\n      document.body.focus();\r\n    }\r\n  } else {\r\n    data.activeElement && data.activeElement.focus && data.activeElement.focus();\r\n  }\r\n\r\n  document.body.removeChild(data.iframe);\r\n\r\n  // restore scroll position\r\n  window.scrollTop = data.windowScrollTop;\r\n  window.scrollLeft = data.windowScrollLeft;\r\n  document.body.scrollTop = data.bodyScrollTop;\r\n  document.body.scrollLeft = data.bodyScrollLeft;\r\n}\r\n\r\nexport default function(tests) {\r\n  const data = before();\r\n\r\n  const results = {};\r\n  Object.keys(tests).map(function(key) {\r\n    results[key] = test(data, tests[key]);\r\n  });\r\n\r\n  after(data);\r\n  return results;\r\n}\r\n"]}