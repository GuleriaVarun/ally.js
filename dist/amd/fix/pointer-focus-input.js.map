{"version":3,"sources":["../../src/fix/pointer-focus-input.js"],"names":["engage","disengage","relevantToCurrentBrowser","platform","is","OSX","GECKO","WEBKIT","handleMouseDownEvent","event","defaultPrevented","target","context","window","setImmediate","setTimeout","focus","handleMouseUpEvent","element","addEventListener","removeEventListener"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;AAgBA,MAAIA,eAAJ;AACA,MAAIC,kBAAJ;AACA;AACA,MAAMC,2BAA2BC,mBAASC,EAAT,CAAYC,GAAZ,KAAoBF,mBAASC,EAAT,CAAYE,KAAZ,IAAqBH,mBAASC,EAAT,CAAYG,MAArD,CAAjC;;AAEA,MAAI,CAACL,wBAAL,EAA+B;AAC7BF,aAAS,kBAAW,CAAE,CAAtB;AACD,GAFD,MAEO;AACL,QAAMQ,uBAAuB,SAAvBA,oBAAuB,CAASC,KAAT,EAAgB;AAC3C,UAAIA,MAAMC,gBAAN,IAA0B,CAAC,8BAAeD,MAAME,MAArB,EAA6B,yBAA7B,CAA/B,EAAwF;AACtF;AACA;AACA;AACD;;AAED,UAAMA,SAAS,2BAAe;AAC5BC,iBAASH,MAAME;AADa,OAAf,CAAf;;AAIA;AACA,OAACE,OAAOC,YAAP,IAAuBD,OAAOE,UAA/B,EAA2C,YAAW;AACpDJ,eAAOK,KAAP;AACD,OAFD;AAGD,KAfD;;AAiBA,QAAMC,qBAAqB,SAArBA,kBAAqB,CAASR,KAAT,EAAgB;AACzC,UAAIA,MAAMC,gBAAN,IAA0B,CAAC,8BAAeD,MAAME,MAArB,EAA6B,gBAA7B,CAA/B,EAA+E;AAC7E;AACA;AACA;AACD;;AAED,UAAMA,SAAS,2BAAe;AAC5BC,iBAASH,MAAME;AADa,OAAf,CAAf;;AAIA,UAAI,CAACA,MAAL,EAAa;AACX;AACD;;AAEDA,aAAOK,KAAP;AACD,KAhBD;;AAkBAhB,aAAS,gBAASkB,OAAT,EAAkB;AACzBA,cAAQC,gBAAR,CAAyB,WAAzB,EAAsCX,oBAAtC,EAA4D,KAA5D;AACA;AACAU,cAAQC,gBAAR,CAAyB,SAAzB,EAAoCF,kBAApC,EAAwD,KAAxD;AACD,KAJD;;AAMAhB,gBAAY,mBAASiB,OAAT,EAAkB;AAC5BA,cAAQE,mBAAR,CAA4B,WAA5B,EAAyCZ,oBAAzC,EAA+D,KAA/D;AACAU,cAAQE,mBAAR,CAA4B,SAA5B,EAAuCH,kBAAvC,EAA2D,KAA3D;AACD,KAHD;AAID;;oBAEc,+BAAgB,EAAEjB,cAAF,EAAUC,oBAAV,EAAhB,C","file":"pointer-focus-input.js","sourcesContent":["/*\r\n  Clicking on form field does not necessarily assign it focus in Safari and Firefox on Mac OS X.\r\n  While not a browser bug, it may be considered undesired behavior.\r\n\r\n  https://bugs.webkit.org/show_bug.cgi?id=22261\r\n  https://bugs.webkit.org/show_bug.cgi?id=118043\r\n\r\n  Note: This behavior can be turned off in Firefox by changing the\r\n  option `accessibility.mouse_focuses_formcontrol` in about:config\r\n*/\r\n\r\nimport getFocusTarget from '../get/focus-target';\r\nimport decorateContext from '../util/decorate-context';\r\nimport elementMatches from '../util/element-matches';\r\nimport platform from '../util/platform';\r\n\r\nlet engage;\r\nlet disengage;\r\n// This fix is only relevant to Safari and Firefox on OSX\r\nconst relevantToCurrentBrowser = platform.is.OSX && (platform.is.GECKO || platform.is.WEBKIT);\r\n\r\nif (!relevantToCurrentBrowser) {\r\n  engage = function() {};\r\n} else {\r\n  const handleMouseDownEvent = function(event) {\r\n    if (event.defaultPrevented || !elementMatches(event.target, 'input, button, button *')) {\r\n      // abort if the mousedown event was cancelled,\r\n      // or we're not dealing with an affected form control\r\n      return;\r\n    }\r\n\r\n    const target = getFocusTarget({\r\n      context: event.target,\r\n    });\r\n\r\n    // we need to set focus AFTER the mousedown finished, otherwise WebKit will ignore the call\r\n    (window.setImmediate || window.setTimeout)(function() {\r\n      target.focus();\r\n    });\r\n  };\r\n\r\n  const handleMouseUpEvent = function(event) {\r\n    if (event.defaultPrevented || !elementMatches(event.target, 'label, label *')) {\r\n      // abort if the mouseup event was cancelled,\r\n      // or we're not dealing with a <label>\r\n      return;\r\n    }\r\n\r\n    const target = getFocusTarget({\r\n      context: event.target,\r\n    });\r\n\r\n    if (!target) {\r\n      return;\r\n    }\r\n\r\n    target.focus();\r\n  };\r\n\r\n  engage = function(element) {\r\n    element.addEventListener('mousedown', handleMouseDownEvent, false);\r\n    // <label> elements redirect focus upon mouseup, not mousedown\r\n    element.addEventListener('mouseup', handleMouseUpEvent, false);\r\n  };\r\n\r\n  disengage = function(element) {\r\n    element.removeEventListener('mousedown', handleMouseDownEvent, false);\r\n    element.removeEventListener('mouseup', handleMouseUpEvent, false);\r\n  };\r\n}\r\n\r\nexport default decorateContext({ engage, disengage });\r\n"]}