{"version":3,"sources":["../../src/get/insignificant-branches.js"],"names":["context","filter","label","defaultToDocument","length","TypeError","queryInsignificantBranches","containsFilteredElement","node","containsNode","parent","some","insiginificantBranches","CollectInsignificantBranchesFilter","element","NodeFilter","FILTER_REJECT","FILTER_ACCEPT","push","acceptNode","_document","walker","createTreeWalker","SHOW_ELEMENT","nextNode"],"mappings":";;;;;;;;;;;;;;;;;;;oBA6De,YAAiC;AAAA,oFAAJ,EAAI;AAAA,QAAvBA,OAAuB,SAAvBA,OAAuB;AAAA,QAAdC,MAAc,SAAdA,MAAc;;AAC9CD,cAAU,gCAAiB;AACzBE,aAAO,4BADkB;AAEzBC,yBAAmB,IAFM;AAGzBH;AAHyB,KAAjB,CAAV;;AAMAC,aAAS,yBAAUA,MAAV,CAAT;AACA,QAAI,CAACA,OAAOG,MAAZ,EAAoB;AAClB,YAAM,IAAIC,SAAJ,CAAc,0DAAd,CAAN;AACD;;AAED,WAAOC,2BAA2B;AAChCN,sBADgC;AAEhCC;AAFgC,KAA3B,CAAP;AAID,G;;;;;;;;;;;;;;AA5ED;AACA;AACA;AACA;AACA;;AAOA,WAASK,0BAAT,OAAuD;AAAA,QAAlBN,OAAkB,QAAlBA,OAAkB;AAAA,QAATC,MAAS,QAATA,MAAS;;AACrD,QAAMM,0BAA0B,SAA1BA,uBAA0B,CAASC,IAAT,EAAe;AAC7C,UAAMC,eAAe,0CAAoB,EAACC,QAAQF,IAAT,EAApB,CAArB;AACA,aAAOP,OAAOU,IAAP,CAAYF,YAAZ,CAAP;AACD,KAHD;;AAKA;AACA,QAAMG,yBAAyB,EAA/B;;AAEA;AACA,QAAMC,qCAAqC,SAArCA,kCAAqC,CAASL,IAAT,EAAe;AACxD,UAAIP,OAAOU,IAAP,CAAY;AAAA,eAAWH,SAASM,OAApB;AAAA,OAAZ,CAAJ,EAA8C;AAC5C;AACA,eAAOC,WAAWC,aAAlB;AACD;;AAED,UAAIT,wBAAwBC,IAAxB,CAAJ,EAAmC;AACjC;AACA,eAAOO,WAAWE,aAAlB;AACD;;AAED;AACAL,6BAAuBM,IAAvB,CAA4BV,IAA5B;AACA,aAAOO,WAAWC,aAAlB;AACD,KAdD;AAeA;AACA;AACAH,uCAAmCM,UAAnC,GAAgDN,kCAAhD;;AAEA,QAAMO,YAAY,2BAAYpB,OAAZ,CAAlB;AACA;AACA,QAAMqB,SAASD,UAAUE,gBAAV;AACb;AACAtB,WAFa;AAGb;AACAe,eAAWQ,YAJE;AAKb;AACAV,sCANa;AAOb;AACA,SARa,CAAf;;AAWA,WAAOQ,OAAOG,QAAP,EAAP,EAA0B;AACxB;AACD;;AAED,WAAOZ,sBAAP;AACD","file":"insignificant-branches.js","sourcesContent":["\r\n// find all highest elements within context that do not contain any of the filter elements.\r\n// (basically the tree minus the parent paths of each filtered element reduced to the top most nodes)\r\n// originally inspired by Marcy Sutton's Material Dialog Component:\r\n// https://github.com/angular/material/blob/v0.11.1/src/components/dialog/dialog.js#L748-L783\r\n// to avoid this behavior: https://marcysutton.com/slides/mobile-a11y-seattlejs/#/36\r\n\r\nimport contextToElement from '../util/context-to-element';\r\nimport nodeArray from '../util/node-array';\r\nimport {getParentComparator} from '../util/compare-position';\r\nimport getDocument from '../util/get-document';\r\n\r\nfunction queryInsignificantBranches({context, filter}) {\r\n  const containsFilteredElement = function(node) {\r\n    const containsNode = getParentComparator({parent: node});\r\n    return filter.some(containsNode);\r\n  };\r\n\r\n  // We'd use a Set() for this, if we could\r\n  const insiginificantBranches = [];\r\n\r\n  // see https://developer.mozilla.org/en-US/docs/Web/API/NodeFilter\r\n  const CollectInsignificantBranchesFilter = function(node) {\r\n    if (filter.some(element => node === element)) {\r\n      // we've hit a filtered element and can ignore its children\r\n      return NodeFilter.FILTER_REJECT;\r\n    }\r\n\r\n    if (containsFilteredElement(node)) {\r\n      // we've hit a significant tree, so we'll have to keep investigating\r\n      return NodeFilter.FILTER_ACCEPT;\r\n    }\r\n\r\n    // we've found an insignificant tree\r\n    insiginificantBranches.push(node);\r\n    return NodeFilter.FILTER_REJECT;\r\n  };\r\n  // IE requires a function, Browsers require {acceptNode: function}\r\n  // see https://www.bennadel.com/blog/2607-finding-html-comment-nodes-in-the-dom-using-treewalker.htm\r\n  CollectInsignificantBranchesFilter.acceptNode = CollectInsignificantBranchesFilter;\r\n\r\n  const _document = getDocument(context);\r\n  // see https://developer.mozilla.org/en-US/docs/Web/API/Document/createTreeWalker\r\n  const walker = _document.createTreeWalker(\r\n    // root element to start search in\r\n    context,\r\n    // element type filter\r\n    NodeFilter.SHOW_ELEMENT,\r\n    // custom NodeFilter filter\r\n    CollectInsignificantBranchesFilter,\r\n    // deprecated, but IE requires it\r\n    false\r\n  );\r\n\r\n  while (walker.nextNode()) {\r\n    // collection things is happening through the filter method\r\n  }\r\n\r\n  return insiginificantBranches;\r\n}\r\n\r\nexport default function({context, filter} = {}) {\r\n  context = contextToElement({\r\n    label: 'get/insignificant-branches',\r\n    defaultToDocument: true,\r\n    context,\r\n  });\r\n\r\n  filter = nodeArray(filter);\r\n  if (!filter.length) {\r\n    throw new TypeError('get/insignificant-branches requires valid options.filter');\r\n  }\r\n\r\n  return queryInsignificantBranches({\r\n    context,\r\n    filter,\r\n  });\r\n}\r\n"]}