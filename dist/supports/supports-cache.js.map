{"version":3,"sources":["../../src/supports/supports-cache.js"],"names":["readLocalStorage","key","data","window","localStorage","getItem","JSON","parse","e","writeLocalStorage","value","document","hasFocus","removeItem","setItem","stringify","userAgent","navigator","cacheKey","cache","version","get","set","values","Object","keys","forEach","time","Date","toISOString"],"mappings":";;;;;;AAQA;;;;;;AAEA,SAASA,gBAAT,CAA0BC,GAA1B,EAA+B;AAC7B;AACA;AACA,MAAIC,aAAJ;;AAEA,MAAI;AACFA,WAAOC,OAAOC,YAAP,IAAuBD,OAAOC,YAAP,CAAoBC,OAApB,CAA4BJ,GAA5B,CAA9B;AACAC,WAAOA,OAAOI,KAAKC,KAAL,CAAWL,IAAX,CAAP,GAA0B,EAAjC;AACD,GAHD,CAGE,OAAOM,CAAP,EAAU;AACVN,WAAO,EAAP;AACD;;AAED,SAAOA,IAAP;AACD,C,CAvBD;;;;;;;;AAyBA,SAASO,iBAAT,CAA2BR,GAA3B,EAAgCS,KAAhC,EAAuC;AACrC,MAAI,CAACC,SAASC,QAAT,EAAL,EAA0B;AACxB;AACA;AACA;AACA,QAAI;AACFT,aAAOC,YAAP,IAAuBD,OAAOC,YAAP,CAAoBS,UAApB,CAA+BZ,GAA/B,CAAvB;AACD,KAFD,CAEE,OAAOO,CAAP,EAAU;AACV;AACD;;AAED;AACD;;AAED,MAAI;AACFL,WAAOC,YAAP,IAAuBD,OAAOC,YAAP,CAAoBU,OAApB,CAA4Bb,GAA5B,EAAiCK,KAAKS,SAAL,CAAeL,KAAf,CAAjC,CAAvB;AACD,GAFD,CAEE,OAAOF,CAAP,EAAU;AACV;AACD;AACF;;AAED,IAAMQ,YAAY,OAAOb,MAAP,KAAkB,WAAlB,IAAiCA,OAAOc,SAAP,CAAiBD,SAAlD,IAA+D,EAAjF;AACA,IAAME,WAAW,qBAAjB;AACA,IAAIC,QAAQnB,iBAAiBkB,QAAjB,CAAZ;;AAEA;AACA,IAAIC,MAAMH,SAAN,KAAoBA,SAApB,IAAiCG,MAAMC,OAAN,KAAkBA,iBAAvD,EAAgE;AAC9DD,UAAQ,EAAR;AACD;;AAEDA,MAAMH,SAAN,GAAkBA,SAAlB;AACAG,MAAMC,OAAN,GAAgBA,iBAAhB;;kBAEe;AACbC,OAAK,eAAW;AACd,WAAOF,KAAP;AACD,GAHY;AAIbG,OAAK,aAASC,MAAT,EAAiB;AACpBC,WAAOC,IAAP,CAAYF,MAAZ,EAAoBG,OAApB,CAA4B,UAASzB,GAAT,EAAc;AACxCkB,YAAMlB,GAAN,IAAasB,OAAOtB,GAAP,CAAb;AACD,KAFD;;AAIAkB,UAAMQ,IAAN,GAAa,IAAIC,IAAJ,GAAWC,WAAX,EAAb;AACApB,sBAAkBS,QAAlB,EAA4BC,KAA5B;AACD;AAXY,C","file":"supports-cache.js","sourcesContent":["/*\r\n    Facility to cache test results in localStorage.\r\n\r\n    USAGE:\r\n      cache.get('key');\r\n      cache.set('key', 'value');\r\n */\r\n\r\nimport version from '../version';\r\n\r\nfunction readLocalStorage(key) {\r\n  // allow reading from storage to retrieve previous support results\r\n  // even while the document does not have focus\r\n  let data;\r\n\r\n  try {\r\n    data = window.localStorage && window.localStorage.getItem(key);\r\n    data = data ? JSON.parse(data) : {};\r\n  } catch (e) {\r\n    data = {};\r\n  }\r\n\r\n  return data;\r\n}\r\n\r\nfunction writeLocalStorage(key, value) {\r\n  if (!document.hasFocus()) {\r\n    // if the document does not have focus when tests are executed, focus() may\r\n    // not be handled properly and events may not be dispatched immediately.\r\n    // This can happen when a document is reloaded while Developer Tools have focus.\r\n    try {\r\n      window.localStorage && window.localStorage.removeItem(key);\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  try {\r\n    window.localStorage && window.localStorage.setItem(key, JSON.stringify(value));\r\n  } catch (e) {\r\n    // ignore\r\n  }\r\n}\r\n\r\nconst userAgent = typeof window !== 'undefined' && window.navigator.userAgent || '';\r\nconst cacheKey = 'ally-supports-cache';\r\nlet cache = readLocalStorage(cacheKey);\r\n\r\n// update the cache if ally or the user agent changed (newer version, etc)\r\nif (cache.userAgent !== userAgent || cache.version !== version) {\r\n  cache = {};\r\n}\r\n\r\ncache.userAgent = userAgent;\r\ncache.version = version;\r\n\r\nexport default {\r\n  get: function() {\r\n    return cache;\r\n  },\r\n  set: function(values) {\r\n    Object.keys(values).forEach(function(key) {\r\n      cache[key] = values[key];\r\n    });\r\n\r\n    cache.time = new Date().toISOString();\r\n    writeLocalStorage(cacheKey, cache);\r\n  },\r\n};\r\n"]}